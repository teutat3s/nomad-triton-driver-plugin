name: Go tests

# Triggers the workflow on push or pull request events
on: 
  push:
    branches:
      - "f-remotetask-3"
  pull_request:
    branches:
      - "f-remotetask-3"

jobs:

  build:
    name: Run Go tests
    runs-on: ubuntu-latest
    steps:

    - name: Set up Go 1.15
      uses: actions/setup-go@v2
      with:
        go-version: ^1.15
      id: go

    - name: Check out code into the Go module directory
      uses: actions/checkout@v2

    - name: Get nomad source with f-remotetask-3 branch
      run: |
        cd ..
        git clone https://github.com/teutat3s/nomad
        cd nomad
        git checkout f-remotetask-3-v1.0.0-beta2
        cd ../nomad-triton-driver-plugin
        sed -i /home/d go.mod
        echo "replace github.com/hashicorp/nomad => /home/runner/work/nomad-triton-driver-plugin/nomad" >> go.mod


    - name: Get dependencies
      run: |
        go get -v -t -d ./...

    - name: Test
      run: go test -v ./...

